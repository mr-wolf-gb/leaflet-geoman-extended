<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Menu - Leaflet-Geoman</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />
    <link rel="stylesheet" href="../dist/leaflet-geoman.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        .header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 1rem 0;
            text-align: center;
        }
        
        .nav {
            background: #f8f9fa;
            padding: 0.5rem 0;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }
        
        .nav a {
            color: #007bff;
            text-decoration: none;
            margin: 0 1rem;
            font-size: 0.9rem;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        
        .demo-info {
            background: #d1ecf1;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            border-left: 4px solid #17a2b8;
        }
        
        .map-container { 
            height: 600px; 
            position: relative;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            overflow: hidden;
        }
        
        #map { height: 100%; width: 100%; }
        
        .instructions {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.95);
            padding: 1rem;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            max-width: 320px;
            z-index: 1000;
        }
        
        .context-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .action-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1rem;
        }
        
        .action-card h4 { 
            color: #495057; 
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .action-icon { 
            font-size: 1.2rem; 
            margin-right: 0.5rem; 
        }
        
        .action-card p { 
            color: #6c757d; 
            font-size: 0.9rem; 
            line-height: 1.5; 
        }
        
        .event-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }
        
        .event-log h4 { margin-bottom: 0.5rem; color: #495057; }
        .log-entry { 
            padding: 0.25rem 0; 
            border-bottom: 1px solid #e9ecef;
            color: #6c757d;
        }
        .log-entry:last-child { border-bottom: none; }
        .log-entry.new { 
            background: #d4edda; 
            color: #155724;
            animation: highlight 1s ease-out;
        }
        
        @keyframes highlight {
            from { background: #28a745; color: white; }
            to { background: #d4edda; color: #155724; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Context Menu System</h1>
            <p>Right-click interactions for layer management</p>
        </div>
    </div>

    <div class="nav">
        <a href="advanced-shapes.html">‚Üê Advanced Shapes</a>
        <a href="index.html">Main Demo</a>
        <a href="events.html">Events ‚Üí</a>
    </div>

    <div class="container">
        <div class="demo-info">
            <h3>Context Menu Features</h3>
            <p>Right-click on any shape or empty map area to access context-sensitive menus. These provide quick access to editing operations, layer management, and custom actions without cluttering the main toolbar.</p>
        </div>

        <div class="map-container">
            <div id="map"></div>
            <div class="instructions">
                <h4>Try These Actions</h4>
                <ul style="margin-left: 1rem; color: #6c757d; font-size: 0.9rem; line-height: 1.6;">
                    <li><strong>Right-click shapes:</strong> Edit, delete, copy, style options</li>
                    <li><strong>Right-click map:</strong> Paste, create new shapes</li>
                    <li><strong>Right-click vertices:</strong> Add/remove points</li>
                    <li><strong>Shift+right-click:</strong> Alternative actions</li>
                </ul>
                <p style="margin-top: 1rem; font-size: 0.8rem; color: #6c757d;">
                    Events are logged below the map for demonstration.
                </p>
            </div>
        </div>

        <div class="event-log">
            <h4>Context Menu Events</h4>
            <div id="eventLog">
                <div class="log-entry">Ready - Right-click on shapes or map to see context menus</div>
            </div>
        </div>

        <div class="context-actions">
            <div class="action-card">
                <h4><span class="action-icon">üéØ</span>Shape Context Menu</h4>
                <p>Right-click on any drawn shape to access editing options: edit vertices, delete shape, copy to clipboard, change style, or convert to different shape type.</p>
            </div>

            <div class="action-card">
                <h4><span class="action-icon">üó∫Ô∏è</span>Map Context Menu</h4>
                <p>Right-click on empty map areas to access global actions: paste copied shapes, create new shapes at cursor position, or access map-wide settings.</p>
            </div>

            <div class="action-card">
                <h4><span class="action-icon">üìç</span>Vertex Context Menu</h4>
                <p>Right-click on shape vertices during edit mode to add new points, remove existing points, or modify vertex properties for precise shape control.</p>
            </div>

            <div class="action-card">
                <h4><span class="action-icon">üìã</span>Copy & Paste</h4>
                <p>Use context menus to copy shapes and paste them elsewhere. Copied shapes maintain their styling and can be pasted multiple times.</p>
            </div>

            <div class="action-card">
                <h4><span class="action-icon">üé®</span>Quick Styling</h4>
                <p>Access common styling options directly from the context menu without opening the full style editor. Change colors, opacity, and stroke properties quickly.</p>
            </div>

            <div class="action-card">
                <h4><span class="action-icon">‚öôÔ∏è</span>Custom Actions</h4>
                <p>Add your own custom menu items to the context menu system. Perfect for integrating application-specific actions and workflows.</p>
            </div>
        </div>

        <div class="demo-info">
            <h3>Customization</h3>
            <p>The context menu system is fully customizable. You can add custom menu items, modify existing ones, or completely replace the default menus to match your application's needs.</p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@latest/dist/leaflet.js"></script>
    <script src="../dist/leaflet-geoman.js"></script>
    <script>
        // Initialize map
        const map = L.map('map').setView([51.505, -0.09], 13);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Add controls with context menu enabled
        map.pm.addControls({
            position: 'topleft',
            drawPolygon: true,
            drawPolyline: true,
            drawCircle: true,
            drawRectangle: true,
            drawMarker: true,
            drawText: true,
            editMode: true,
            dragMode: true,
            removalMode: true,
            copyLayerMode: true
        });

        // Enable context menu
        map.pm.setGlobalOptions({
            contextMenu: true,
            contextMenuItems: [
                {
                    text: 'Custom Action',
                    callback: function(e) {
                        logEvent('Custom menu item clicked');
                    }
                }
            ]
        });

        // Event logging function
        const eventLog = document.getElementById('eventLog');
        let eventCounter = 0;

        function logEvent(message) {
            eventCounter++;
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry new';
            entry.textContent = `[${timestamp}] ${message}`;
            
            eventLog.insertBefore(entry, eventLog.firstChild);
            
            // Remove 'new' class after animation
            setTimeout(() => {
                entry.classList.remove('new');
            }, 1000);
            
            // Keep only last 20 entries
            while (eventLog.children.length > 20) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }

        // Add sample shapes with different styles
        setTimeout(() => {
            // Polygon with custom context menu
            const polygon = L.polygon([
                [51.509, -0.08],
                [51.503, -0.06],
                [51.51, -0.047]
            ], {
                color: '#e74c3c',
                fillColor: '#e74c3c',
                fillOpacity: 0.3
            }).addTo(map);

            // Polyline
            L.polyline([
                [51.5, -0.1],
                [51.495, -0.083],
                [51.49, -0.075]
            ], {
                color: '#2ecc71',
                weight: 4
            }).addTo(map);

            // Circle
            L.circle([51.508, -0.11], {
                radius: 200,
                color: '#f39c12',
                fillColor: '#f39c12',
                fillOpacity: 0.3
            }).addTo(map);

            // Rectangle
            L.rectangle([
                [51.515, -0.12],
                [51.52, -0.1]
            ], {
                color: '#9b59b6',
                fillColor: '#9b59b6',
                fillOpacity: 0.3
            }).addTo(map);

            // Marker
            L.marker([51.515, -0.09]).addTo(map);

            logEvent('Sample shapes added - right-click to see context menus');
        }, 1000);

        // Context menu event handlers
        map.on('pm:contextmenu', (e) => {
            logEvent(`Context menu opened on ${e.layer ? 'layer' : 'map'}`);
        });

        map.on('pm:edit', (e) => {
            logEvent('Layer edited via context menu');
        });

        map.on('pm:remove', (e) => {
            logEvent('Layer removed via context menu');
        });

        map.on('pm:copy', (e) => {
            logEvent('Layer copied to clipboard');
        });

        map.on('pm:paste', (e) => {
            logEvent('Layer pasted from clipboard');
        });

        // General event handlers
        map.on('pm:create', (e) => {
            logEvent(`${e.shape} created`);
        });

        map.on('contextmenu', (e) => {
            logEvent(`Right-click at ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`);
        });

        // Add custom context menu items programmatically
        map.on('pm:contextmenu', (e) => {
            if (e.layer) {
                // Add custom menu item for layers
                e.layer.pm.setOptions({
                    contextMenuItems: [
                        {
                            text: 'Get Layer Info',
                            callback: function() {
                                const info = {
                                    type: e.layer.constructor.name,
                                    bounds: e.layer.getBounds ? e.layer.getBounds() : 'N/A',
                                    options: e.layer.options
                                };
                                logEvent(`Layer info: ${JSON.stringify(info, null, 2)}`);
                            }
                        }
                    ]
                });
            }
        });
    </script>
</body>
</html>